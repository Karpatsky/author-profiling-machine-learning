tree processing code is sometimes *so* elegant. It can also get shockingly bad